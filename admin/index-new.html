<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel CMS ¬∑ Ganbara</title>
  <link rel="icon" type="image/png" href="../assets/Logo_color_ganbara.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inknut+Antiqua:wght@700&family=Playfair+Display:wght@600;700&family=Texturina:wght@400;500;600&family=Poppins:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="cms-styles.css">
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash-screen" class="splash-screen">
    <div class="splash-content">
      <img src="../assets/Logo_color_ganbara.png" alt="Ganbara Logo" class="splash-logo">
      <h1 class="splash-title">Ganbara CMS</h1>
      <p class="splash-subtitle">Cargando panel de administraci√≥n...</p>
      <div class="splash-loader">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <!-- CMS Container -->
  <div id="nc-root"></div>

  <!-- Netlify Identity & CMS Scripts -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  
  <script>
    // Netlify Identity Integration
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on('init', user => {
        if (!user) {
          window.netlifyIdentity.on('login', () => {
            document.location.href = '/admin/';
          });
        }
      });
    }

    // Custom CMS Initialization
    window.addEventListener('load', () => {
      const splashScreen = document.getElementById('splash-screen');
      
      // Wait for CMS to mount
      const checkCMSMount = setInterval(() => {
        const cmsRoot = document.querySelector('#nc-root > div');
        if (cmsRoot) {
          clearInterval(checkCMSMount);
          
          // Hide splash screen
          setTimeout(() => {
            splashScreen.classList.add('fade-out');
            setTimeout(() => {
              splashScreen.style.display = 'none';
            }, 500);
          }, 800);
          
          // Initialize custom UI enhancements
          initializeCustomUI();
        }
      }, 100);
    });

    function initializeCustomUI() {
      // Add custom branding and hero sections
      const observer = new MutationObserver(() => {
        injectCustomElements();
      });

      const cmsRoot = document.querySelector('#nc-root');
      if (cmsRoot) {
        observer.observe(cmsRoot, { childList: true, subtree: true });
        injectCustomElements();
      }
    }

    function injectCustomElements() {
      const mainContent = document.querySelector('[class*="MainContent"]');
      if (!mainContent || mainContent.dataset.customized) return;

      // Get current collection from URL
      const hash = window.location.hash;
      const collectionMatch = hash.match(/collection\/([^\/]+)/);
      const collection = collectionMatch ? collectionMatch[1] : null;

      // Don't inject on edit/new pages
      if (hash.includes('/entry/') || hash.includes('/new')) return;

      // Inject hero section
      if (collection && !mainContent.querySelector('.custom-hero')) {
        const hero = createHeroSection(collection);
        mainContent.insertBefore(hero, mainContent.firstChild);
      }

      mainContent.dataset.customized = 'true';
    }

    function createHeroSection(collection) {
      const heroData = {
        bocadillos: {
          title: 'Bocadillos',
          subtitle: 'Gestiona los bocadillos del men√∫',
          icon: 'ü•ñ'
        },
        raciones: {
          title: 'Raciones',
          subtitle: 'Gestiona las raciones del men√∫',
          icon: 'üçΩÔ∏è'
        },
        hamburguesas: {
          title: 'Hamburguesas',
          subtitle: 'Gestiona las hamburguesas del men√∫',
          icon: 'üçî'
        },
        chuleta: {
          title: 'Chuleta',
          subtitle: 'Gestiona los platos de chuleta',
          icon: 'ü•©'
        },
        postres: {
          title: 'Postres',
          subtitle: 'Gestiona los postres del men√∫',
          icon: 'üç∞'
        },
        hero: {
          title: 'Hero Carousel',
          subtitle: 'Gestiona las im√°genes destacadas de la portada',
          icon: 'üé®'
        }
      };

      const data = heroData[collection] || { title: 'Contenido', subtitle: 'Gestiona el contenido', icon: 'üìÑ' };

      const hero = document.createElement('div');
      hero.className = 'custom-hero';
      hero.innerHTML = `
        <div class="hero-content">
          <div class="hero-icon">${data.icon}</div>
          <div class="hero-text">
            <h1 class="hero-title">${data.title}</h1>
            <p class="hero-subtitle">${data.subtitle}</p>
          </div>
        </div>
        <div class="hero-actions">
          <button class="hero-btn-primary" onclick="window.location.hash += '/new'">
            <span>+ Crear nuevo</span>
          </button>
        </div>
      `;

      return hero;
    }

    // Hash change listener to re-inject hero
    window.addEventListener('hashchange', () => {
      const mainContent = document.querySelector('[class*="MainContent"]');
      if (mainContent) {
        mainContent.dataset.customized = '';
        const existingHero = mainContent.querySelector('.custom-hero');
        if (existingHero) existingHero.remove();
      }
      setTimeout(injectCustomElements, 100);
    });
  </script>
</body>
</html>
